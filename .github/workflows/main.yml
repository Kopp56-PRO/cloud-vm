name: CI
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Disable UAC
        run: |
          Set-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System" -Name "EnableLUA" -Value 0
          Set-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value 0
          Set-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorUser" -Value 0
        shell: pwsh

      - name: Set Up Anydesk
        run: |
          curl -o Anydesk.exe https://download.anydesk.com/AnyDesk.exe

          Start-Process -FilePath "AnyDesk.exe" -ArgumentList "/S" -Wait
        shell: pwsh

      - name: Set up unattended access
        run: |
          $anydeskPassword = "YourStrongPassword"
          Set-Content -Path "C:\ProgramData\AnyDesk\service.conf" -Value "[anydesk]`npassword_hash = $anydeskPassword"
        shell: pwsh
